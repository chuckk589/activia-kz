(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-80f72352"],{2815:function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("CExtendedModal",{attrs:{vis:t.modalConfig.show,mData:t.modalConfig.data},on:{"modal-closed":function(e){return t.closeModalHandler()}},scopedSlots:t._u([{key:"content",fn:function(){return[t.modalConfig.data.path?o("CImg",{attrs:{fluidGrow:"",src:t.modalConfig.data.path}}):t._e()]},proxy:!0}])}),o("CDataTable",{staticStyle:{"user-select":"none"},attrs:{sorter:"",hover:"",items:t.items,fields:t.fields,"column-filter":""},on:{"row-clicked":t.rowClick},scopedSlots:t._u([{key:"over-table",fn:function(){return[o("div",{staticStyle:{display:"flex"}},[o("CLink",{staticClass:"btn-square btn btn-primary btn-sm",staticStyle:{"margin-right":"3px"},attrs:{href:t.getCurrentItems(),download:"table-data.csv",target:"_blank"}},[t._v("Скачать (.csv)")]),o("CButton",{staticClass:"btn btn-primary ",attrs:{shape:"square",size:"sm"},on:{click:t.newLotteryInit}},[t._v(" Новый розыгрыш")]),o("div",{staticStyle:{"margin-left":"auto",display:"flex","align-items":"center"}},[o("span",{staticStyle:{"margin-right":"5px"}},[t._v("Режим для записи")]),o("CSwitch",{attrs:{color:"primary",size:"sm",checked:t.mode},on:{"update:checked":function(e){t.mode=e}}})],1)],1)]},proxy:!0},{key:"action",fn:function(e){var n=e.item;return[o("td",[o("CDropdown",{staticClass:"m-2",attrs:{addTogglerClasses:"btn-square",size:"sm","toggler-text":"Действия",color:"primary"}},[o("CDropdownItem",{on:{click:function(e){return t.changeLotteryStatus(n)}}},[t._v("Изменить")]),o("CDropdownItem",{on:{click:function(e){return t.deleteLottery(n)}}},[t._v("Удалить")])],1)],1)]}},{key:"details",fn:function(e){var n=e.item;return[o("CCollapse",{staticClass:"subtable",attrs:{show:Boolean(n._toggled),duration:t.collapseDuration}},[o("CRow",[o("CCol",[t._v("Основной")]),o("CCol",[t._v("Подтвержден")]),o("CCol",[t._v("Уведомлен")]),o("CCol",[t._v("Id чека")]),o("CCol",[t._v("Id сертификата")]),o("CCol",[t._v("Имя")]),o("CCol",[t._v("Номер")]),o("CCol",[t._v("Город")]),o("CCol",[t._v("Чек")]),o("CCol")],1),t._l(n.winners,(function(e,n){return!t.mode||e.primary?o("CRow",{key:n},[o("CCol",[t._v(t._s(e.primary?"Да":"Нет"))]),o("CCol",[t._v(t._s(e.confirmed?"Да":"Нет"))]),o("CCol",[t._v(t._s(e.notified?"Да":"Нет"))]),o("CCol",[t._v(t._s(e.fancyId))]),o("CCol",[t._v(t._s(e.prizeId))]),o("CCol",[t._v(t._s(e.credentials))]),o("CCol",[t._v(t._s(t.phoneFormatter(e.phone)))]),o("CCol",[t._v(t._s(e.city))]),o("CCol",[o("CButton",{attrs:{shape:"square",size:"sm",color:"primary"},on:{click:function(o){return t.viewCheck(e.checkPath)}}},[o("CIcon",{attrs:{size:"sm",name:"cilImage"}})],1)],1),o("CCol",[o("CDropdown",{staticClass:"btn-square m-2",attrs:{addTogglerClasses:"btn-square","toggler-text":"Действия",size:"sm",color:"primary"}},[o("CDropdownItem",{on:{click:function(o){return t.sendNotify(e)}}},[t._v("Уведомить о выигрыше")]),o("CDropdownItem",{on:{click:function(o){return t.approveWinner(e)}}},[t._v("Подтвердить")])],1)],1)],1):t._e()}))],2)]}}])})],1)},a=[],i=o("b33f"),l={name:"Lottery",components:{CExtendedModal:i["a"]},data:function(){return{mode:!1,collapseDuration:0,modalConfig:{show:!1,data:{}},items:[{winners:[]}],fields:[{key:"id",label:"Id Розыгрыша"},{key:"start",label:"Начало"},{key:"end",label:"Конец"},{key:"status",label:"Статус"},{key:"prize",label:"Приз"},{key:"primaryWinners",label:"Основные победители"},{key:"reserveWinners",label:"Резервные победители"},{key:"createdAt",label:"Дата создания"},{key:"action",label:"",filter:!1,sorter:!1}]}},mounted:function(){var t=this;this.$http({method:"GET",url:"/v1/lottery/"}).then((function(e){t.items=e.data}))},methods:{phoneFormatter:function(t){return t.slice(0,-6)+"XXXX"+t.slice(-2)},viewCheck:function(t){this.modalConfig.data={path:t,footer:"Ок",header:"Просмотр чека",type:"viewCheck"},this.modalConfig.show=!0},rowClick:function(t,e,o){var n=this;"details"!==o&&"action"!==o&&(t._toggled=!t._toggled,this.collapseDuration=300,this.$nextTick((function(){n.collapseDuration=0})))},sendNotify:function(t){this.$http({method:"POST",url:"/v1/winner/".concat(t.id,"/notification")}).then((function(e){t.notified=!0}))},approveWinner:function(t){this.$http({method:"PUT",url:"/v1/winner/".concat(t.id),data:{confirmed:!t.confirmed}}).then((function(e){t.confirmed=!t.confirmed}))},newLotteryInit:function(){this.modalConfig.data={fields:[{label:"Дата розыгрыша",key:"start",type:"date"},{label:"Конец",key:"end",type:"date"},{label:"Что разыгрываем",key:"prize",select:this.$ctable.prizes,value:this.$ctable.prizes[0].value},{label:"Основные победители",key:"primaryWinners",type:"number"}],footer:"Создать",header:"Новый розыгрыш",type:"newLottery"},this.modalConfig.show=!0},closeModalHandler:function(){var t=this;if("newLottery"==this.modalConfig.data.type){var e=this.modalConfig.data.fields.reduce((function(t,e){return t[e.key]=e.value,t}),{});e.reserveWinners=e.primaryWinners,this.$http({method:"POST",url:"/v1/lottery/",data:e}).then((function(e){t.items.push(e.data),t.modalConfig.show=!1}))}else if("editLottery"==this.modalConfig.data.type){var o=this.modalConfig.data.fields[0].value;this.$http({method:"PUT",url:"/v1/lottery/".concat(this.modalConfig.data.cur.id),data:{status:o}}).then((function(){t.modalConfig.data.cur.status=t.$ctable.lottery_statuses.find((function(t){return t.value==o})).label}))}else"deleteLottery"==this.modalConfig.data.type&&this.$http({method:"DELETE",url:"/v1/lottery/".concat(this.modalConfig.data.cur.id)}).then((function(){var e=t.items.findIndex((function(e){return e.id==t.modalConfig.data.cur.id}));t.items.splice(e,1),t.modalConfig.show=!1}))},changeLotteryStatus:function(t){var e;this.modalConfig.data={cur:t,fields:[{key:"status",label:"Статус",select:this.$ctable.lottery_statuses,value:null===(e=this.$ctable.lottery_statuses.find((function(e){return e.label==t.status})))||void 0===e?void 0:e.value}],footer:"Сохранить",header:"Статус розыгрыша",type:"editLottery"},this.modalConfig.show=!0},deleteLottery:function(t){this.modalConfig.data={cur:t,fields:[],footer:"Подтвердить",header:"Удалить розыгрыш?",type:"deleteLottery"},this.modalConfig.show=!0},getCurrentItems:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.items,e="Id Розыгрыша,Дата,Приз,Основной,Подтвержден,Уведомлен,Id чека,Имя,Номер,Город,Сертификат",o="data:text/csv;charset=utf-8,"+e+"%0A"+encodeURIComponent(t.reduce((function(t,e){var o="".concat(e.id,",").concat(e.createdAt,",").concat(e.prize,",").concat(e.primary?"Да":"Нет",",").concat(e.confirmed?"Да":"Нет",",").concat(e.notified?"Да":"Нет");return e.winners.forEach((function(e){t=t+o+",".concat(e.fancyId,",").concat(e.credentials,",").concat(e.phone,",").concat(e.city,",").concat(e.prize,"\n")})),t}),""));return o}},computed:{}},r=l,s=(o("ff8c"),o("2877")),c=Object(s["a"])(r,n,a,!1,null,"1dc87de9",null);e["default"]=c.exports},b33f:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("CModal",{attrs:{show:t.vis,title:t.mData.header},on:{"update:show":function(e){t.vis=e}},scopedSlots:t._u([{key:"footer",fn:function(){return[o("CButton",{attrs:{shape:"square",color:"primary"},on:{click:function(e){return t.closeModal()}}},[t._v(t._s(t.mData.footer))])]},proxy:!0}])},[t._t("content"),t._l(t.mData.fields,(function(e,n){return[t.$scopedSlots[e.label]?[t._t(e.label,null,{item:e})]:e.select?o("CSelect",{key:n,attrs:{label:e.label,value:e.value,options:"bool"==e.select?t.boolSelect:e.select},on:{"update:value":function(o){return t.$set(e,"value",o)}}}):o("CInput",{key:n,attrs:{label:e.label,type:e.type},model:{value:e.value,callback:function(o){t.$set(e,"value",o)},expression:"field.value"}})]}))],2)},a=[],i={name:"ExtendedModal",data:function(){return{boolSelect:[{value:1,label:"Да"},{value:0,label:"Нет"}]}},props:{vis:Boolean,mData:Object},methods:{closeModal:function(){this.vis=!1,this.$emit("modal-closed")}}},l=i,r=o("2877"),s=Object(r["a"])(l,n,a,!1,null,null,null);e["a"]=s.exports},d2c9:function(t,e,o){},ff8c:function(t,e,o){"use strict";o("d2c9")}}]);
//# sourceMappingURL=chunk-80f72352.c48d383c.js.map